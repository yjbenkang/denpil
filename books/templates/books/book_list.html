<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>denpil</title>

    <!-- Google Fonts 사용 (예: Merriweather 폰트) -->
    <link href="https://fonts.googleapis.com/earlyaccess/notosanskr.css" rel="stylesheet">
    <style>
        /* 기본적인 Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            //background-color: #dbd6d0;
            font-family: 'Noto Sans KR', serif;
            color: #333;
            line-height: 1.6;
            padding: 40px;
        }

        h2 {
            font-size: 22px;
            color: #4a4a4a;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #d1c4a9;
            padding-bottom: 5px;
        }

        /* 전체 컨테이너 */
        .container {
            display: flex;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            border: 1px solid #d1c4a9;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .contents {
            width: 900px;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        /* 작가 목록 섹션 */
        .author-list {
            width: 30%;
            padding: 20px;
            background-color: #faf8f3;
            border-radius: 10px;
            border: 1px solid #d1c4a9;
        }

        /* 작가 아이템 스타일 */
        .author-item {
            display: flex;
            justify-content: space-between; /* 왼쪽과 오른쪽 끝으로 배치 */
            padding: 12px 15px;
            margin-bottom: 15px;
            background-color: #fdfdfb;
            border: 1px solid #eae7db;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .author-item:hover {
            background-color: #e7e4d6;
            transform: translateY(-3px);
        }

        .author-name {
            flex-grow: 1; /* 이름을 왼쪽에 */
            text-align: left;
        }

        .author-year {
            text-align: right;
            color: #888; /* 연도의 색상을 약간 어둡게 */
        }

        #author-name {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .author-info {
            display: flex;
            align-items: center;
            background-color: #f9f9f9;
            padding: 15px;
            margin-bottom: 30px; /* 책 목록과의 간격 */
        }

        .author-content {
            display: flex;
            align-items: center;  /* 사진과 설명을 세로로 가운데 정렬 */
            justify-content: space-between; /* 공간 균등 분배 */
            gap: 30px; /* 사진과 설명 사이 간격 */
        }

        /* 작가 초상화 스타일 */
        .author-portrait img {
            width: 150px; /* 초상화 크기 */
            height: 150px;
            object-fit: cover; /* 이미지 비율 유지 */
            border-radius: 5%; /* 원형으로 표시 */
        }

        /* 작가 설명 스타일 */
        .author-details {
            flex-grow: 1; /* 설명 영역이 남은 공간을 차지 */
        }

        #author-description {
            font-size: 20px;
        }

        .book-info {
            height: 700px;
        }

        #book-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 그리드 레이아웃으로 표시 */
            gap: 20px; /* 그리드 항목 사이 간격 */
            padding: 0;
            list-style: none;
        }

        /* LI 스타일 */
        .book-item {
            background-color: #f8f9fa;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-align: center;
            width: 220px;
            overflow: hidden; /* 오버플로우된 텍스트 숨기기 */
            white-space: nowrap; /* 한 줄로 표시 */
            text-overflow: ellipsis; /* 너무 긴 경우 생략 부호(...) 표시 */
            max-width: 100%; /* 최대 너비를 그리드 셀에 맞춤 */
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .book-item:hover {
            background-color: #e9ecef; /* 호버 시 배경색 변경 */
        }

        #book-grid {
            max-height: 600px; /* UL의 최대 높이 제한 */
            overflow-y: auto; /* 세로 스크롤 허용 */
        }

        #book-thumbnail {
            object-fit: cover; /* 이미지 비율 유지 */
            margin-bottom: 10px;
        }

        #book-description {
            line-height: 1.9;
            overflow: hidden; /* 오버플로우된 텍스트 숨기기 */
            text-overflow: ellipsis; /* 너무 긴 경우 생략 부호(...) 표시 */
            overflow-y: auto; /* 세로 스크롤 허용 */
        }

        /* 책 상세 정보 컨테이너 */
        .book-detail-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        /* 책 표지 이미지가 잘 맞도록 설정 */
        .book-detail-left {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #book-cover {
            width: 100%;          /* 이미지가 부모 요소의 전체 너비를 차지하게 설정 */
            max-width: 150px;      /* 이미지 최대 너비를 150px로 설정 */
            height: auto;          /* 자동으로 높이를 맞추어 비율 유지 */
            object-fit: contain;   /* 이미지가 깨지지 않고 비율 유지 */
            border-radius: 5px;    /* 이미지에 모서리 둥글기 추가 */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);  /* 약간의 그림자 효과 */
        }

        /* 오른쪽: 책 세부 정보 */
        .book-detail-right {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 10px; /* 각 항목 간의 간격 */
        }

        /* 책 제목 스타일 */
        .book-detail-right h3 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }

        /* 텍스트 설명 스타일 */
        .book-detail-right p {
            font-size: 16px;
            line-height: 1.5;
            color: #666;
        }

        /* 책 링크 버튼 스타일 */
        .book-detail-right a {
            display: inline-block;
            width: 100%; /* 버튼을 전체 너비로 설정 */
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #737300;  /* 기본 색상 */
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            font-size: 16px;
            font-weight: bold;
            text-align: center; /* 텍스트를 가운데 정렬 */
        }

        .book-detail-right a:hover {
            background-color: #5c5a00;  /* 호버 시 어울리는 진한 색상 */
        }

        /* 목록으로 돌아가기 버튼 스타일 */
        #back-to-list {
            background-color: #777;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 20px;
        }

        #back-to-list:hover {
            background-color: #555;
        }

        /* 반응형 그리드: 화면이 작아질 때 열 수를 줄임 */
        @media (max-width: 768px) {
            .contents ul {
                grid-template-columns: repeat(2, 1fr); /* 2개의 열 */
            }
        }

        @media (max-width: 480px) {
            .contents ul {
                grid-template-columns: 1fr; /* 1개의 열 */
            }
        }

        .stat-selection {
            margin-bottom: 30px;
        }

        #stat-dropdown {
            border: 1px solid #d1c4a9;  /* 테두리 */
            padding: 3px;  /* 내부 여백 */
            border-radius: 5px;  /* 모서리 둥글게 */
            font-size: 16px;  /* 글꼴 크기 */
            width: 100px;  /* 드롭다운 너비 */
            margin-left: 10px;
            margin-right: 7px;
        }

        /* 버튼 스타일 */
        button {
            background-color: transparent;
            color: #b09c64;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover {
            background-color: #777;
        }


        /* 반응형 레이아웃 */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .author-list,
            .contents {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="author-list">
            <h2>노벨 문학상 수상자 목록</h2>
            <ul>
                {% for author in authors %}
                    <li class="author-item" data-author-id="{{ author.id }}">
                        <span class="author-name">{{ author.name }}</span>
                        <span class="author-year">{{ author.nominated_year }}</span>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <div class="contents">
            <!-- 작가 설명 섹션 -->
            <h2 id="author-name">작가를 선택해주세요.</h2>
            <div id="author-info" class="author-info" style="display:none;">
                <div class="author-content">
                    <!-- 왼쪽: 작가 사진 -->
                    <div class="author-portrait">
                        <!-- 작가 사진 URL SRC 추가 요망!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
                        <img id="author-image" src="https://upload.wikimedia.org/wikipedia/commons/a/a4/Sully_Prudhomme%2C_Ren%C3%A9-Fran%C3%A7ois-Armand%2C_BNF_Gallica.jpg" alt="작가 초상화" />
                    </div>
                    <!-- 오른쪽: 작가 설명 -->
                    <div class="author-details">
                        <p id="author-description">작가 설명이 여기에 나옵니다.</p>
                    </div>
                </div>
            </div>

            <!-- 책 목록 섹션 -->
            <div id="book-info" class="book-info" style="display:none;">
                <h2 id="book-title">저서 목록</h2>
                <div id="book-grid">
                    <ul id="book-list"></ul>
                </div>

                <div id="book-details" style="display:none;"></div>
            </div>

            <!-- 책 통계 섹션 -->
            <div id="book-statics" class="book-statics" style="display:none;">
                <h2 id="book-stat">저서 통계</h2>
                <div id="stat-selection" class="stat-selection">

                    <select id="stat-dropdown">
                        <option value="sales_point">판매량</option>
                        <option value="rating_score">별점</option>
                        <option value="pricestandard">가격</option>
                        <option value="best_rank">최고 순위</option>
                    </select>
                    <button id="stat-search">검색</button>
                </div>


                <canvas id="book-chart" width="400" height="200"></canvas>
            </div>
        </div>

    </div>

    <!-- jQuery와 AJAX 요청 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        var bookChart = null;
        var bookTitles = [];
        var bookDataByStat = {};
        var currentStat = 'sales_point';

        function initGrid() {
            $('#book-title').html('저서 목록');
            $('#book-details').hide();
            $('#book-grid').show();
        }

        function updateChart(labels, data) {
            if (bookChart) {
                // 차트가 이미 생성되어 있으면 데이터를 업데이트하고 재렌더링
                bookChart.data.labels = labels;  // 새로운 책 제목
                bookChart.data.datasets[0].data = data;  // 새로운 판매량
                bookChart.update();  // 차트를 업데이트하여 변경사항 반영
            } else {
                var ctx = document.getElementById('book-chart').getContext('2d'); // 저서 통계 구현
                bookChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,  // 책 제목
                        datasets: [{
                            data: data,
                            backgroundColor: 'olive',
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        },
                        plugins: {
                            legend: {
                                display: false  // 레이블 숨기기
                            }
                        }
                    }
                });
            }
        }

        $(document).ready(function() {
            // 작가 클릭 시 해당 작가의 책 목록 및 통계 가져오기
            $('.author-item').on('click', function() {
                var authorId = $(this).data('author-id');
                $.ajax({
                    url: 'author/' + authorId + '/',
                    type: 'GET',
                    success: function(response) {
                        // 작가 설명 표시
                        $('#author-name').text(response.author.name); // 작가 이름
                        $('#author-description').text(response.author.description); // 작가 설명
                        $('#author-image').attr('src', response.author.image);
                        $('#author-info').show(); // 작가 설명 섹션 표시
                        initGrid()
                        $('#book-info').show(); // 저서 목록 표시
                        $('#book-statics').show(); // 저서 통계 표시

                        var bookList = $('#book-list'); // 저서 목록 구현, 책 제목 리스트 채우기
                        bookList.empty();

                        bookTitles = [];
                        bookDataByStat = {};
                        if (response.books.length > 0) {
                            response.books.forEach(function(book) {
                                bookList.append(
                                    '<li class="book-item" data-book-id="' + book.id + '">' +
                                    '<div class="book-thumbnail"><img id="author-image" src='+book.cover_url+' alt="작가 초상화" /></div>'+
                                    book.title + '</li>'
                                    );

                                bookTitles.push(book.title);


                                if (!bookDataByStat["sales_point"]) { bookDataByStat["sales_point"] = []; }
                                bookDataByStat["sales_point"].push(book.sales_point);

                                if (!bookDataByStat["pricesales"]) { bookDataByStat["pricesales"] = []; }
                                bookDataByStat["pricesales"].push(book.pricesales);

                                if (!bookDataByStat["pricestandard"]) { bookDataByStat["pricestandard"] = []; }
                                bookDataByStat["pricestandard"].push(book.pricestandard);

                                if (!bookDataByStat["rating_score"]) { bookDataByStat["rating_score"] = []; }
                                bookDataByStat["rating_score"].push(book.rating_score);

                                if (!bookDataByStat["rating_count"]) { bookDataByStat["rating_count"] = []; }
                                bookDataByStat["rating_count"].push(book.rating_count);

                                if (!bookDataByStat["best_rank"]) { bookDataByStat["best_rank"] = []; }
                                bookDataByStat["best_rank"].push(book.best_rank);

                            });
                        } else {
                            bookList.append('<li>저서가 없습니다.</li>');
                        }
                        updateChart(bookTitles, bookDataByStat[currentStat]);

                    },
                    error: function(request, status, error) {
                        //alert(error);
                        alert('책 목록을 불러오는 데 실패했습니다.');
                    }
                });
            });

            // 책 클릭 시 해당 책의 설명 페이지를 불러옴
            $(document).on('click', '.book-item', function() {
                var bookId = $(this).data('book-id');
                $.ajax({
                    url: 'book/' + bookId + '/',
                    type: 'GET',
                    success: function(response) {
                        // 책 목록을 숨기고 책 설명을 표시
                        $('#book-title').text(response.title);
                        $('#book-grid').hide();
                        $('#book-details').html(
                            '<div class="book-detail-container">' +
                                '<div class="book-detail-left">' +
                                    '<img id="book-cover" src="' + response.cover_url + '" alt="책 표지" />' +
                                '</div>' +
                                '<div class="book-detail-right">' +
                                    '<h3>' + response.title + '</h3>' +
                                    '<p><strong>저자:</strong> ' + response.author + '</p>' +
                                    '<p><strong>출판일:</strong> ' + response.pubdate + '</p>' +
                                    '<p id="book-description"><strong>설명:</strong> ' + response.description + '</p>' +
                                    '<p><strong>판매가:</strong> ' + response.pricesales + '원</p>' +
                                    '<p><strong>정가:</strong> ' + response.pricestandard + '원</p>' +
                                    '<p><strong>평점:</strong> ' + response.rating_score + ' (' + response.rating_count + '명)</p>' +
                                    '<p><strong>베스트 순위:</strong> ' + response.best_rank + '</p>' +
                                    '<p><strong>출판사:</strong> ' + response.publisher + '</p>' +
                                    '<p><strong>판매 지수:</strong> ' + response.sales_point + '</p>' +
                                    '<a href="' + response.link + '" target="_blank">책 링크</a>' +
                                    '<button id="back-to-list">목록으로</button>' +
                                '</div>' +
                            '</div>'
                        ).show();
                    },
                    error: function(request, status, error) {
                        alert(error);
                        //alert('책 설명을 불러오는 데 실패했습니다.');
                    }
                });
            });

            // 뒤로가기 버튼을 눌렀을 때
            $(document).on('click', '#back-to-list', function() { initGrid() });
            $(document).on('click', '#stat-search', function() {
                // 드롭다운에서 선택된 값을 가져오기
                currentStat = document.getElementById('stat-dropdown').value;
                updateChart(bookTitles, bookDataByStat[currentStat]);
            });
        });

    </script>
</body>
</html>